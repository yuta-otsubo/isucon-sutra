# perl

## ディレクトリ構成

```
perl/
├── lib/
│   └── Isuride/
│       └── App.pm          # メインアプリケーションモジュール
├── local/                  # 依存モジュールのインストール先
├── .gitignore             # Gitで無視するファイル設定
├── app.psgi               # PSGIアプリケーションエントリーポイント
├── cpanfile               # 依存モジュール定義ファイル
├── cpanfile.snapshot      # 依存モジュールのバージョン固定ファイル
├── Dockerfile             # Dockerコンテナ設定
└── NOTE.md                # 開発メモ
```

### 各ファイルの役割

- **app.psgi**: PSGI アプリケーションのエントリーポイント。Plack サーバーが読み込む
- **cpanfile**: 必要な Perl モジュールを定義。`carton install`で依存関係を解決
- **cpanfile.snapshot**: 依存モジュールのバージョンを固定。再現可能なビルドを保証
- **Dockerfile**: Perl アプリケーション用のコンテナ設定
- **lib/Isuride/App.pm**: Kossy フレームワークを使った Web アプリケーション本体
- **local/**: `carton install`で依存モジュールがインストールされるディレクトリ

## cpanfile

webapp/perl/cpanfile を参照して、依存モジュールをインストールする。
webapp/perl/ ディレクトリに移動して実行する。

```
carton install
```

※ 何故かすべての依存関係が追加されない。今はまだわからないので後ほど調査する。

## アプリに接続(ローカル)

```
docker build -t isuride-perl .
docker run -p 8080:8080 isuride-perl
```

## .perltidyrc

プロジェクトルートの `.perltidyrc` は Perl コードフォーマッターの設定ファイル。
perltidy コマンドでコードを自動整形する際の規則を定義している。

主な設定内容:

- UTF-8 エンコーディング使用
- else 文の抱き合わせスタイル
- インデント 4 スペース
- 最大行長制限なし
- 括弧の密着度設定
- コメントのインデント設定

開発時にコードの統一性を保つために使用される。

## 疑問

**.pm ファイルとは？**
.pm ファイルは、Perl（パール）というプログラミング言語で使われる「モジュール」のファイルです。Perl でコードを部品化・再利用するための仕組みで、プログラムから「use モジュール名;」のように呼び出して使います。中には関数やクラス、定数などをまとめて記述します。

**主な用途**
主に複数のスクリプトで共通して使いたい処理や、外部ライブラリの提供などに利用されます。Perl の標準ライブラリや CPAN の多くも.pm ファイルで提供されています。

**特徴**
ファイルの最後に「1;」と書くのが慣例で、これによりモジュールの読み込みが成功したことを Perl が確認できます。
